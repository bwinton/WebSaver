<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>spread</title>
    <!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
    <script type="text/javascript">
        var startradius = 20;
        var width = 600;
        var height = 600;
        var frame_time = 30;
        var straighten_factor = 0.95;
        var curviness = 0.2;
        var color_speed = 0.03;
        var new_branch_frames = 2;
        var branch_shrink = 0.95;
        var branch_opacity = 0.4;
    
        var paper;
        var current;
        var points = [];
        var frame = 0;
        var fadecheck;
        var cyclecheck;
        var randomizecheck;
        var wrapcheck;
    
        function paper_click(event) {
            draw_point(event.pageX - paper.canvas.offsetLeft, event.pageY - paper.canvas.offsetTop);
        }
        
        function draw_point(newPoint) {
            current.x = (current.x + newPoint.x) / 2;
            current.y = (current.y + newPoint.y) / 2;
            current.r = (current.r + newPoint.r) / 2;
            current.g = (current.g + newPoint.g) / 2;
            current.b = (current.b + newPoint.b) / 2;
            var colour = "rgb(" + Math.floor(current.r * 255) +
                         "," + Math.floor(current.g * 255) +
                         "," + Math.floor(current.b * 255) + ")";
            paper.fillStyle = colour;
            paper.fillRect(current.x, current.y, 2, 2);
        }
        
        function Point(x, y, r, g, b) {
            this.x = x;
            this.y = y;
            this.r = r;
            this.g = g;
            this.b = b;
        }
        
        function clock_tick() {
            if (fadecheck.checked) {
                paper.fillRect(0,0,width,height);
            }

            var index = Math.random() * points.length;
            index = Math.floor(index);
            var point = points[index];
            draw_point(point);
        }
        
        function setup() {
            fadecheck = document.getElementById("fadecheck");
            cyclecheck = document.getElementById("cyclecheck");
            randomizecheck = document.getElementById("randomizecheck");
            wrapcheck = document.getElementById("wrapcheck");
        
            var notepad = document.getElementById("notepad");

            width = notepad.width = window.innerWidth;
            height = notepad.height = window.innerHeight;
      
            paper = notepad.getContext("2d");
            paper.fillStyle = "rgb(0,0, 0)";
            paper.fillRect(0,0,width,height);

            points = [
                new Point(width/2, 10, 1, 0, 0 ),
                new Point(10, height-10, 0, 1, 0),
                new Point(width-10, height-10, 0, 0, 1)
            ];
            current = new Point(width/2, height/2, .5, .5, .5);

            notepad.onclick = paper_click;
            document.getElementById("branchframestext").onblur = function() {new_branch_frames = parseInt(this.value);};

            setInterval(clock_tick, frame_time);
        }
        
    </script>
  </head>
  <body onload="setup()">
    <p>
        <input type="checkbox" id="cyclecheck" checked="checked" /> <label for="cyclecheck">Cycle colors</label>
        <input type="checkbox" id="fadecheck" /> <label for="fadecheck">Fade</label>
        <input type="checkbox" id="randomizecheck" checked="checked" /> <label for="randomizecheck">Randomize Position</label>
        <input type="checkbox" id="wrapcheck" /> <label for="wrapcheck">Wrap Edges</label>
        <br />
        <label for="branchframestext">Spawn new every n frames:</label> <input type="text" id="branchframestext" value="1" size="3" />
    </p>
    <canvas id="notepad" width="600" height="600" style="position: absolute; top: 0px; left: 0px;"></canvas>
  </body>
</html>
